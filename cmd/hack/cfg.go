package main

import (
	"bufio"
	"encoding/hex"
	"encoding/json"
	"flag"
	"fmt"
	"github.com/ledgerwatch/turbo-geth/common"
	"github.com/ledgerwatch/turbo-geth/core/vm"
	"log"
	"math/big"
	"os"
	"os/exec"
	"runtime"
	"strconv"
	"strings"
	"time"
)

var maxStackLen = 1024
var maxStackCount = 25600000
var maxAnlyCounterLimit = 1048756
var maxSecs int64 = 600
var maxMBs uint64 = 1000

var mode = flag.String("mode", "test", "Mode for cfg analysis.")
var bytecode = flag.String("bytecode", "0x00", "Bytecode for cfg analysis")
var quiet = flag.Bool("quiet", false, "Quiet for cfg analysis")

func testGenCfg() {
	if *mode == "sync" {
		AbsIntTestStagedSync()
		return
	}

	if *mode == "worker" {
		code, _ := hex.DecodeString(*bytecode)
		worker(code)
		return
	}

	if *mode == "server" {
		batchServer()
		return
	}

	if *mode == "test" {

		//absIntTestSimple00()
		//absIntTestStoreDynamic00()
		//absIntTestStorageIntoMemory()
		//absIntTestRequires00()
		//absIntTestCall01()
		//absIntTestDiv00()
		//absIntTestEcrecoverLoop02()
		//absIntTestStorageVar03()
		//absIntTestStaticLoop00()
		//absIntTestPrivateFunction01()
		//absIntTestPrivateFunction02()
		//absIntTestStaticLoop01()
		//absIntTestDepositContract()
		/*absIntTestPanic00()
		//absIntTestSmallImprecision()
		//absIntTestSmallInvalidJumpDest()
		//absIntTestSmallImprecision2()
		//absIntAndJumpImprecision()*/
		//absIntCfgFailure()
		//absIntGreeter()
		//absIntStorageGuard()
//		absIntUniswap()
		//absIntERC20Burnable()
		//absIntERC20MintBurn()
		//absIntERC20()
		//absIntTestERC20min()
		//absIntTestERC20()
		//absIntERC20Memory()

		absIntRetDynStr()

		return
	}
}

func absIntRetDynStr() {
	const s = "608060405234801561001057600080fd5b506004361061002b5760003560e01c806306fdde0314610030575b600080fd5b6100386100b3565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561007857808201518184015260208101905061005d565b50505050905090810190601f1680156100a55780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b606060008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561014b5780601f106101205761010080835404028352916020019161014b565b820191906000526020600020905b81548152906001019060200180831161012e57829003601f168201915b505050505090509056fea2646970667358221220bb57b25a5ea725d8216c5b26bc353b62b9ce01b2c5da9e5d1e166689431e43cb64736f6c634300060c0033"
	runCfgAnly("Ret Dyn Str", s)
}

func absIntERC20() {
	const s = "608060405234801561001057600080fd5b50600436106100a95760003560e01c80633950935111610071578063395093511461025857806370a08231146102bc57806395d89b4114610314578063a457c2d714610397578063a9059cbb146103fb578063dd62ed3e1461045f576100a9565b806306fdde03146100ae578063095ea7b31461013157806318160ddd1461019557806323b872dd146101b3578063313ce56714610237575b600080fd5b6100b66104d7565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100f65780820151818401526020810190506100db565b50505050905090810190601f1680156101235780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61017d6004803603604081101561014757600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610579565b60405180821515815260200191505060405180910390f35b61019d610597565b6040518082815260200191505060405180910390f35b61021f600480360360608110156101c957600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506105a1565b60405180821515815260200191505060405180910390f35b61023f61067a565b604051808260ff16815260200191505060405180910390f35b6102a46004803603604081101561026e57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610691565b60405180821515815260200191505060405180910390f35b6102fe600480360360208110156102d257600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610744565b6040518082815260200191505060405180910390f35b61031c61078c565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561035c578082015181840152602081019050610341565b50505050905090810190601f1680156103895780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6103e3600480360360408110156103ad57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061082e565b60405180821515815260200191505060405180910390f35b6104476004803603604081101561041157600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506108fb565b60405180821515815260200191505060405180910390f35b6104c16004803603604081101561047557600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610919565b6040518082815260200191505060405180910390f35b606060038054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561056f5780601f106105445761010080835404028352916020019161056f565b820191906000526020600020905b81548152906001019060200180831161055257829003601f168201915b5050505050905090565b600061058d6105866109a0565b84846109a8565b6001905092915050565b6000600254905090565b60006105ae848484610b9f565b61066f846105ba6109a0565b61066a8560405180606001604052806028815260200161101960289139600160008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006106206109a0565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e609092919063ffffffff16565b6109a8565b600190509392505050565b6000600560009054906101000a900460ff16905090565b600061073a61069e6109a0565b8461073585600160006106af6109a0565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f2090919063ffffffff16565b6109a8565b6001905092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b606060048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108245780601f106107f957610100808354040283529160200191610824565b820191906000526020600020905b81548152906001019060200180831161080757829003601f168201915b5050505050905090565b60006108f161083b6109a0565b846108ec8560405180606001604052806025815260200161108a60259139600160006108656109a0565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e609092919063ffffffff16565b6109a8565b6001905092915050565b600061090f6109086109a0565b8484610b9f565b6001905092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610a2e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260248152602001806110666024913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610ab4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526022815260200180610fd16022913960400191505060405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040518082815260200191505060405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610c25576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260258152602001806110416025913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610cab576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526023815260200180610fae6023913960400191505060405180910390fd5b610cb6838383610fa8565b610d2181604051806060016040528060268152602001610ff3602691396000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e609092919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610db4816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f2090919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a3505050565b6000838311158290610f0d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825283818151815260200191508051906020019080838360005b83811015610ed2578082015181840152602081019050610eb7565b50505050905090810190601f168015610eff5780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385039050809150509392505050565b600080828401905083811015610f9e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f536166654d6174683a206164646974696f6e206f766572666c6f77000000000081525060200191505060405180910390fd5b8091505092915050565b50505056fe45524332303a207472616e7366657220746f20746865207a65726f206164647265737345524332303a20617070726f766520746f20746865207a65726f206164647265737345524332303a207472616e7366657220616d6f756e7420657863656564732062616c616e636545524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636545524332303a207472616e736665722066726f6d20746865207a65726f206164647265737345524332303a20617070726f76652066726f6d20746865207a65726f206164647265737345524332303a2064656372656173656420616c6c6f77616e63652062656c6f77207a65726fa26469706673582212205f455f5a679b826b8f245da65e4a69aac4a2ad0ed8717dff357679e03078204064736f6c63430007060033"
	runCfgAnly("ERC20", s)
}


func absIntERC20Burnable() {
	const s = "608060405234801561001057600080fd5b50600436106100cf5760003560e01c806342966c681161008c57806395d89b411161006657806395d89b41146103b6578063a457c2d714610439578063a9059cbb1461049d578063dd62ed3e14610501576100cf565b806342966c68146102e257806370a082311461031057806379cc679014610368576100cf565b806306fdde03146100d4578063095ea7b31461015757806318160ddd146101bb57806323b872dd146101d9578063313ce5671461025d578063395093511461027e575b600080fd5b6100dc610579565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561011c578082015181840152602081019050610101565b50505050905090810190601f1680156101495780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101a36004803603604081101561016d57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061061b565b60405180821515815260200191505060405180910390f35b6101c3610639565b6040518082815260200191505060405180910390f35b610245600480360360608110156101ef57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610643565b60405180821515815260200191505060405180910390f35b61026561071c565b604051808260ff16815260200191505060405180910390f35b6102ca6004803603604081101561029457600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610733565b60405180821515815260200191505060405180910390f35b61030e600480360360208110156102f857600080fd5b81019080803590602001909291905050506107e6565b005b6103526004803603602081101561032657600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506107fa565b6040518082815260200191505060405180910390f35b6103b46004803603604081101561037e57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610842565b005b6103be6108a4565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103fe5780820151818401526020810190506103e3565b50505050905090810190601f16801561042b5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6104856004803603604081101561044f57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610946565b60405180821515815260200191505060405180910390f35b6104e9600480360360408110156104b357600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610a13565b60405180821515815260200191505060405180910390f35b6105636004803603604081101561051757600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610a31565b6040518082815260200191505060405180910390f35b606060038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106115780601f106105e657610100808354040283529160200191610611565b820191906000526020600020905b8154815290600101906020018083116105f457829003601f168201915b5050505050905090565b600061062f610628610ab8565b8484610ac0565b6001905092915050565b6000600254905090565b6000610650848484610cb7565b6107118461065c610ab8565b61070c8560405180606001604052806028815260200161136160289139600160008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006106c2610ab8565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f789092919063ffffffff16565b610ac0565b600190509392505050565b6000600560009054906101000a900460ff16905090565b60006107dc610740610ab8565b846107d78560016000610751610ab8565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461103890919063ffffffff16565b610ac0565b6001905092915050565b6107f76107f1610ab8565b826110c0565b50565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600061088182604051806060016040528060248152602001611389602491396108728661086d610ab8565b610a31565b610f789092919063ffffffff16565b90506108958361088f610ab8565b83610ac0565b61089f83836110c0565b505050565b606060048054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561093c5780601f106109115761010080835404028352916020019161093c565b820191906000526020600020905b81548152906001019060200180831161091f57829003601f168201915b5050505050905090565b6000610a09610953610ab8565b84610a0485604051806060016040528060258152602001611417602591396001600061097d610ab8565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f789092919063ffffffff16565b610ac0565b6001905092915050565b6000610a27610a20610ab8565b8484610cb7565b6001905092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610b46576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260248152602001806113f36024913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610bcc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001806113196022913960400191505060405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040518082815260200191505060405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610d3d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260258152602001806113ce6025913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610dc3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260238152602001806112d46023913960400191505060405180910390fd5b610dce838383611284565b610e398160405180606001604052806026815260200161133b602691396000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f789092919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610ecc816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461103890919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a3505050565b6000838311158290611025576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825283818151815260200191508051906020019080838360005b83811015610fea578082015181840152602081019050610fcf565b50505050905090810190601f1680156110175780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385039050809150509392505050565b6000808284019050838110156110b6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f536166654d6174683a206164646974696f6e206f766572666c6f77000000000081525060200191505060405180910390fd5b8091505092915050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415611146576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260218152602001806113ad6021913960400191505060405180910390fd5b61115282600083611284565b6111bd816040518060600160405280602281526020016112f7602291396000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610f789092919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506112148160025461128990919063ffffffff16565b600281905550600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a35050565b505050565b60006112cb83836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250610f78565b90509291505056fe45524332303a207472616e7366657220746f20746865207a65726f206164647265737345524332303a206275726e20616d6f756e7420657863656564732062616c616e636545524332303a20617070726f766520746f20746865207a65726f206164647265737345524332303a207472616e7366657220616d6f756e7420657863656564732062616c616e636545524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636545524332303a206275726e20616d6f756e74206578636565647320616c6c6f77616e636545524332303a206275726e2066726f6d20746865207a65726f206164647265737345524332303a207472616e736665722066726f6d20746865207a65726f206164647265737345524332303a20617070726f76652066726f6d20746865207a65726f206164647265737345524332303a2064656372656173656420616c6c6f77616e63652062656c6f77207a65726fa264697066735822122070fa911ae84afe640bd42709023cf8c5394e3e8cde47f61100c7e6c7d9472b4b64736f6c63430007060033"
	runCfgAnly("ERC20Burnable", s)
}

func absIntUniswap() {
	const s = "608060405234801561001057600080fd5b50600436106100885760003560e01c806370a082311161005b57806370a082311461013b578063a457c2d71461016b578063a9059cbb1461019b578063dd62ed3e146101cb57610088565b8063095ea7b31461008d57806318160ddd146100bd57806323b872dd146100db578063395093511461010b575b600080fd5b6100a760048036036100a29190810190610982565b6101fb565b6040516100b49190610a5c565b60405180910390f35b6100c5610212565b6040516100d29190610ab7565b60405180910390f35b6100f560048036036100f09190810190610933565b61021c565b6040516101029190610a5c565b60405180910390f35b61012560048036036101209190810190610982565b6102c4565b6040516101329190610a5c565b60405180910390f35b610155600480360361015091908101906108ce565b610360565b6040516101629190610ab7565b60405180910390f35b61018560048036036101809190810190610982565b6103a8565b6040516101929190610a5c565b60405180910390f35b6101b560048036036101b09190810190610982565b610444565b6040516101c29190610a5c565b60405180910390f35b6101e560048036036101e091908101906108f7565b61045b565b6040516101f29190610ab7565b60405180910390f35b60006102083384846104e2565b6001905092915050565b6000600254905090565b6000610229848484610641565b6102b984336102b4600160008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054866107f9565b6104e2565b600190509392505050565b60006103563384610351600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548661084f565b6104e2565b6001905092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600061043a3384610435600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054866107f9565b6104e2565b6001905092915050565b6000610451338484610641565b6001905092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561051c57600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141561055657600080fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925836040516106349190610ab7565b60405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561067b57600080fd5b6106c36000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054826107f9565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061074d6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548261084f565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516107ec9190610ab7565b60405180910390a3505050565b60008282111561083e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161083590610a77565b60405180910390fd5b600082840390508091505092915050565b60008082840190508381101561089a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161089190610a97565b60405180910390fd5b8091505092915050565b6000813590506108b381610b2b565b92915050565b6000813590506108c881610b42565b92915050565b6000602082840312156108e057600080fd5b60006108ee848285016108a4565b91505092915050565b6000806040838503121561090a57600080fd5b6000610918858286016108a4565b9250506020610929858286016108a4565b9150509250929050565b60008060006060848603121561094857600080fd5b6000610956868287016108a4565b9350506020610967868287016108a4565b9250506040610978868287016108b9565b9150509250925092565b6000806040838503121561099557600080fd5b60006109a3858286016108a4565b92505060206109b4858286016108b9565b9150509250929050565b6109c781610af5565b82525050565b60006109da601783610ad2565b91507f536166654d617468237375623a20554e444552464c4f570000000000000000006000830152602082019050919050565b6000610a1a601683610ad2565b91507f536166654d617468236164643a204f564552464c4f57000000000000000000006000830152602082019050919050565b610a5681610b21565b82525050565b6000602082019050610a7160008301846109be565b92915050565b60006020820190508181036000830152610a90816109cd565b9050919050565b60006020820190508181036000830152610ab081610a0d565b9050919050565b6000602082019050610acc6000830184610a4d565b92915050565b600082825260208201905092915050565b6000610aee82610b01565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b610b3481610ae3565b8114610b3f57600080fd5b50565b610b4b81610b21565b8114610b5657600080fd5b5056fea365627a7a72315820d05528505a708f32b12fbbba887217864cb6303823b08f85af493dcf3d0c49036c6578706572696d656e74616cf564736f6c63430005110040"
	runCfgAnly("Uniswap", s)
}

func absIntStorageGuard() {
	const s = "608060405234801561001057600080fd5b50600436106100365760003560e01c806341c0e1b51461003b578063f851a44014610045575b600080fd5b610043610079565b005b61004d610108565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156101065760008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff168156fea264697066735822122041888665c3ccb786a7d5104db2d7ff0da96c01e21f457d237547a2f22be32ca064736f6c634300060c0033"
	runCfgAnly("StorageGuard", s)
}

func absIntGreeter() {
	const s = "606060405260e060020a600035046341c0e1b58114610026578063cfae321714610068575b005b6100246000543373ffffffffffffffffffffffffffffffffffffffff908116911614156101375760005473ffffffffffffffffffffffffffffffffffffffff16ff5b6100c9600060609081526001805460a06020601f6002600019610100868816150201909416939093049283018190040281016040526080828152929190828280156101645780601f1061013957610100808354040283529160200191610164565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600302600f01f150905090810190601f1680156101295780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b565b820191906000526020600020905b81548152906001019060200180831161014757829003601f168201915b505050505090509056"
	runCfgAnly("SmallNotSSA", s)
}

func absIntCfgFailure() {
	const s = "6080604052600436106101b65763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663018a25e8811461034057806306fdde0314610367578063079ce327146103f15780630f15f4c01461041157806310f01eba1461042657806311a09ae71461044757806324c33d331461045c5780632660316e146104d35780632ce21999146105025780632e19ebdc14610533578063349cdcac1461054b5780633ccfd60b146105695780633ddd46981461057e57806349cc635d146105da5780635893d48114610604578063624ae5c01461061f5780636306643414610634578063685ffd831461066a578063747dff42146106bd57806382bfc739146107485780638f38f3091461076f5780638f7140ea1461077d578063921dec211461079857806395d89b411461036757806398a0871d146107eb578063a2bccae914610802578063a65b37a114610843578063c519500e14610851578063c7e284b814610869578063ce89c80c1461087e578063cf80800014610899578063d53b2679146108b1578063d87574e0146108c6578063de7874f3146108db578063ee0b5d8b14610935575b6101be614d73565b600f5460009060ff16151560011461020e576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b8015610255576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b34633b9aca008110156102ad576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af68000008111156102fd576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b6103068561098e565b33600090815260066020818152604080842054808552600890925290922001549196509450610339908590600288610c42565b5050505050005b34801561034c57600080fd5b50610355610e7c565b60408051918252519081900360200190f35b34801561037357600080fd5b5061037c610f41565b6040805160208082528351818301528351919283929083019185019080838360005b838110156103b657818101518382015260200161039e565b50505050905090810190601f1680156103e35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156103fd57600080fd5b5061040f600435602435604435610f78565b005b34801561041d57600080fd5b5061040f611170565b34801561043257600080fd5b50610355600160a060020a03600435166112a3565b34801561045357600080fd5b506103556112b5565b34801561046857600080fd5b506104746004356112bb565b604080519c8d5260208d019b909b528b8b019990995296151560608b015260808a019590955260a089019390935260c088019190915260e087015261010086015261012085015261014084015261016083015251908190036101800190f35b3480156104df57600080fd5b506104ee60043560243561131e565b604080519115158252519081900360200190f35b34801561050e57600080fd5b5061051a60043561133e565b6040805192835260208301919091528051918290030190f35b34801561053f57600080fd5b50610355600435611357565b34801561055757600080fd5b5061040f600435602435604435611369565b34801561057557600080fd5b5061040f61153b565b6040805160206004803580820135601f810184900484028501840190955284845261040f94369492936024939284019190819084018382808284375094975050600160a060020a038535169550505050506020013515156118a8565b3480156105e657600080fd5b5061040f600435600160a060020a0360243516604435606435611a61565b34801561061057600080fd5b50610355600435602435611c52565b34801561062b57600080fd5b50610355611c6f565b34801561064057600080fd5b5061064c600435611c75565b60408051938452602084019290925282820152519081900360600190f35b6040805160206004803580820135601f810184900484028501840190955284845261040f943694929360249392840191908190840183828082843750949750508435955050505050602001351515611e1b565b3480156106c957600080fd5b506106d2611efb565b604080519e8f5260208f019d909d528d8d019b909b5260608d019990995260808c019790975260a08b019590955260c08a0193909352600160a060020a0390911660e08901526101008801526101208701526101408601526101608501526101808401526101a083015251908190036101c00190f35b34801561075457600080fd5b5061040f600160a060020a03600435166024356044356120f9565b61040f6004356024356122df565b34801561078957600080fd5b5061040f6004356024356124b2565b6040805160206004803580820135601f810184900484028501840190955284845261040f94369492936024939284019190819084018382808284375094975050843595505050505060200135151561258f565b61040f600160a060020a036004351660243561266f565b34801561080e57600080fd5b5061081d600435602435612870565b604080519485526020850193909352838301919091526060830152519081900360800190f35b61040f6004356024356128a2565b34801561085d57600080fd5b5061051a600435612a8b565b34801561087557600080fd5b50610355612aa4565b34801561088a57600080fd5b50610355600435602435612b33565b3480156108a557600080fd5b50610355600435612bdb565b3480156108bd57600080fd5b506104ee612c8d565b3480156108d257600080fd5b50610355612c96565b3480156108e757600080fd5b506108f3600435612c9c565b60408051600160a060020a0390981688526020880196909652868601949094526060860192909252608085015260a084015260c0830152519081900360e00190f35b34801561094157600080fd5b50610956600160a060020a0360043516612ce3565b604080519788526020880196909652868601949094526060860192909252608085015260a084015260c0830152519081900360e00190f35b610996614d73565b336000908152600660205260408120549080821515610c3957604080517fe56556a9000000000000000000000000000000000000000000000000000000008152336004820152905173a80aff4455a89667de2b892aa2b0af60aa5d25329163e56556a99160248083019260209291908290030181600087803b158015610a1b57600080fd5b505af1158015610a2f573d6000803e3d6000fd5b505050506040513d6020811015610a4557600080fd5b5051604080517f82e37b2c00000000000000000000000000000000000000000000000000000000815260048101839052905191945073a80aff4455a89667de2b892aa2b0af60aa5d2532916382e37b2c916024808201926020929091908290030181600087803b158015610ab857600080fd5b505af1158015610acc573d6000803e3d6000fd5b505050506040513d6020811015610ae257600080fd5b5051604080517fe3c08adf00000000000000000000000000000000000000000000000000000000815260048101869052905191935073a80aff4455a89667de2b892aa2b0af60aa5d25329163e3c08adf916024808201926020929091908290030181600087803b158015610b5557600080fd5b505af1158015610b69573d6000803e3d6000fd5b505050506040513d6020811015610b7f57600080fd5b505133600081815260066020908152604080832088905587835260089091529020805473ffffffffffffffffffffffffffffffffffffffff1916909117905590508115610c08576000828152600760209081526040808320869055858352600882528083206001908101869055600a8352818420868552909252909120805460ff191690911790555b8015801590610c175750828114155b15610c315760008381526008602052604090206006018190555b845160010185525b50929392505050565b6005546002546000828152600b602052604090206004015442910181118015610cad57506000828152600b602052604090206002015481111580610cad57506000828152600b602052604090206002015481118015610cad57506000828152600b6020526040902054155b15610cc557610cc0828734888888612db8565b610e74565b6000828152600b602052604090206002015481118015610cf757506000828152600b602052604090206003015460ff16155b15610e3f576000828152600b60205260409020600301805460ff19166001179055610d2183613218565b925080670de0b6b3a764000002836000015101836000018181525050858360200151018360200181815250507fa7801a70b37e729a11492aad44fd3dba89b4149f0609dc0f6837bf9e57e2671a3360086000898152602001908152602001600020600101543486600001518760200151886040015189606001518a608001518b60a001518c60c001518d60e00151604051808c600160a060020a0316600160a060020a031681526020018b600019166000191681526020018a815260200189815260200188815260200187600160a060020a0316600160a060020a0316815260200186600019166000191681526020018581526020018481526020018381526020018281526020019b50505050505050505050505060405180910390a15b600086815260086020526040902060030154610e61903463ffffffff6135a416565b6000878152600860205260409020600301555b505050505050565b6005546002546000828152600b602052604081206004015490929142910181118015610eea57506000828152600b602052604090206002015481111580610eea57506000828152600b602052604090206002015481118015610eea57506000828152600b6020526040902054155b15610f32576000828152600b6020526040902060050154610f2b90670de0b6b3a764000090610f1f908263ffffffff6135a416565b9063ffffffff61360516565b9250610f3c565b6544364c5bb00092505b505090565b60408051808201909152600481527f46756d6f00000000000000000000000000000000000000000000000000000000602082015281565b610f80614d73565b600f54600090819060ff161515600114610fd2576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b8015611019576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b85633b9aca00811015611071576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af68000008111156110c1576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b3360009081526006602052604090205494508815806110f0575060008581526008602052604090206001015489145b1561110e57600085815260086020526040902060060154935061114d565b600089815260076020908152604080832054888452600890925290912060060154909450841461114d5760008581526008602052604090206006018490555b61115688613632565b975061116585858a8a8a613657565b505050505050505050565b600054600160a060020a031633146111d2576040805160e560020a62461bcd02815260206004820152601b60248201527f6f6e6c7920636f6d6d756e6974792063616e2061637469766174650000000000604482015290519081900360640190fd5b600f5460ff161561122d576040805160e560020a62461bcd02815260206004820152601860248201527f7368756f686120616c7265616479206163746976617465640000000000000000604482015290519081900360640190fd5b600f805460ff1916600190811790915560058190556002548154600092909252600b602052429091019081037f72c6bfb7988af3a1efa6568f02a999bc52252641c659d85961ca3d372b57d5d355610708017f72c6bfb7988af3a1efa6568f02a999bc52252641c659d85961ca3d372b57d5d155565b60066020526000908152604090205481565b60045481565b600b60208190526000918252604090912080546001820154600283015460038401546004850154600586015460068701546007880154600889015460098a0154600a8b01549a909b0154989a9799969860ff90961697949693959294919390928c565b600a60209081526000928352604080842090915290825290205460ff1681565b600d602052600090815260409020805460019091015482565b60076020526000908152604090205481565b611371614d73565b600f5460009060ff1615156001146113c1576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b8015611408576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b84633b9aca00811015611460576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af68000008111156114b0576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b3360009081526006602052604090205493508715806114ce57508388145b156114ec576000848152600860205260409020600601549750611519565b60008481526008602052604090206006015488146115195760008481526008602052604090206006018890555b61152287613632565b96506115318489898989613657565b5050505050505050565b600080600080611549614d73565b600f5460ff161515600114611596576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b80156115dd576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b60055433600090815260066020908152604080832054848452600b9092529091206002015491985042975095508611801561162a57506000878152600b602052604090206003015460ff16155b801561164357506000878152600b602052604090205415155b156117e9576000878152600b60205260409020600301805460ff1916600117905561166d83613218565b925061167885613873565b935060008411156116c957600085815260086020526040808220549051600160a060020a039091169186156108fc02918791818181858888f193505050501580156116c7573d6000803e3d6000fd5b505b85670de0b6b3a764000002836000015101836000018181525050848360200151018360200181815250507f0bd0dba8ab932212fa78150cdb7b0275da72e255875967b5cad11464cf71bedc3360086000888152602001908152602001600020600101548686600001518760200151886040015189606001518a608001518b60a001518c60c001518d60e00151604051808c600160a060020a0316600160a060020a031681526020018b600019166000191681526020018a815260200189815260200188815260200187600160a060020a0316600160a060020a0316815260200186600019166000191681526020018581526020018481526020018381526020018281526020019b50505050505050505050505060405180910390a161189f565b6117f285613873565b9350600084111561184357600085815260086020526040808220549051600160a060020a039091169186156108fc02918791818181858888f19350505050158015611841573d6000803e3d6000fd5b505b6000858152600860209081526040918290206001015482513381529182015280820186905260608101889052905186917f8f36579a548bc439baa172a6521207464154da77f411e2da3db2f53affe6cc3a919081900360800190a25b50505050505050565b6000808080808033803b80156118f6576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b6118ff8b6138fa565b604080517faa4d490b000000000000000000000000000000000000000000000000000000008152336004820181905260248201849052600160a060020a038e1660448301528c151560648301528251939b50995034985073a80aff4455a89667de2b892aa2b0af60aa5d25329263aa4d490b928a926084808201939182900301818588803b15801561199057600080fd5b505af11580156119a4573d6000803e3d6000fd5b50505050506040513d60408110156119bb57600080fd5b508051602091820151600160a060020a03808b1660008181526006865260408082205485835260088852918190208054600190910154825188151581529889018790529416878201526060870193909352608086018c90524260a0870152915193995091975095508a92909186917fdd6176433ff5026bbce96b068584b7bbe3514227e72df9c630b749ae87e64442919081900360c00190a45050505050505050505050565b3373a80aff4455a89667de2b892aa2b0af60aa5d253214611af2576040805160e560020a62461bcd02815260206004820152602760248201527f796f7572206e6f7420706c617965724e616d657320636f6e74726163742e2e2e60448201527f20686d6d6d2e2e00000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600160a060020a0383166000908152600660205260409020548414611b2d57600160a060020a03831660009081526006602052604090208490555b6000828152600760205260409020548414611b545760008281526007602052604090208490555b600084815260086020526040902054600160a060020a03848116911614611baa576000848152600860205260409020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0385161790555b6000848152600860205260409020600101548214611bd75760008481526008602052604090206001018290555b6000848152600860205260409020600601548114611c045760008481526008602052604090206006018190555b6000848152600a6020908152604080832085845290915290205460ff161515611c4c576000848152600a602090815260408083208584529091529020805460ff191660011790555b50505050565b600c60209081526000928352604080842090915290825290205481565b60055481565b6005546000818152600b60205260408120600201549091829182919042118015611cb157506000818152600b602052604090206003015460ff16155b8015611cca57506000818152600b602052604090205415155b15611deb576000818152600b6020526040902054851415611daf576000818152600b6020526040902060070154611d3890606490611d0f90603063ffffffff61410d16565b811515611d1857fe5b60008881526008602052604090206002015491900463ffffffff6135a416565b6000868152600960209081526040808320858452909152902060020154611d9190611d7390611d678986614184565b9063ffffffff61425216565b6000888152600860205260409020600301549063ffffffff6135a416565b60008781526008602052604090206004015491955093509150611e13565b600085815260086020908152604080832060029081015460098452828520868652909352922090910154611d9190611d7390611d678986614184565b60008581526008602052604090206002810154600590910154611d9190611d739088906142b2565b509193909250565b6000808080808033803b8015611e69576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b611e728b6138fa565b604080517f745ea0c1000000000000000000000000000000000000000000000000000000008152336004820181905260248201849052604482018e90528c151560648301528251939b50995034985073a80aff4455a89667de2b892aa2b0af60aa5d25329263745ea0c1928a926084808201939182900301818588803b15801561199057600080fd5b60008060008060008060008060008060008060008060006005549050600b60008281526020019081526020016000206009015481600b600084815260200190815260200160002060050154600b600085815260200190815260200160002060020154600b600086815260200190815260200160002060040154600b600087815260200190815260200160002060070154600b600088815260200190815260200160002060000154600a02600b6000898152602001908152602001600020600101540160086000600b60008b815260200190815260200160002060000154815260200190815260200160002060000160009054906101000a9004600160a060020a031660086000600b60008c815260200190815260200160002060000154815260200190815260200160002060010154600c60008b8152602001908152602001600020600080815260200190815260200160002054600c60008c815260200190815260200160002060006001815260200190815260200160002054600c60008d815260200190815260200160002060006002815260200190815260200160002054600c60008e8152602001908152602001600020600060038152602001908152602001600020546003546103e802600454019e509e509e509e509e509e509e509e509e509e509e509e509e509e5050909192939495969798999a9b9c9d565b612101614d73565b600f54600090819060ff161515600114612153576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b801561219a576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b85633b9aca008110156121f2576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af6800000811115612242576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b336000908152600660205260409020549450600160a060020a03891615806122725750600160a060020a03891633145b1561229057600085815260086020526040902060060154935061114d565b600160a060020a03891660009081526006602081815260408084205489855260089092529092200154909450841461114d57600085815260086020526040902060060184905561115688613632565b6122e7614d73565b600f5460009060ff161515600114612337576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b801561237e576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b34633b9aca008110156123d6576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af6800000811115612426576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b61242f8561098e565b33600090815260066020526040902054909550935086158061245057508387145b1561246e57600084815260086020526040902060060154965061249b565b600084815260086020526040902060060154871461249b5760008481526008602052604090206006018790555b6124a486613632565b955061189f84888888610c42565b3373a80aff4455a89667de2b892aa2b0af60aa5d253214612543576040805160e560020a62461bcd02815260206004820152602760248201527f796f7572206e6f7420706c617965724e616d657320636f6e74726163742e2e2e60448201527f20686d6d6d2e2e00000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b6000828152600a6020908152604080832084845290915290205460ff16151561258b576000828152600a602090815260408083208484529091529020805460ff191660011790555b5050565b6000808080808033803b80156125dd576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b6125e68b6138fa565b604080517fc0942dfd000000000000000000000000000000000000000000000000000000008152336004820181905260248201849052604482018e90528c151560648301528251939b50995034985073a80aff4455a89667de2b892aa2b0af60aa5d25329263c0942dfd928a926084808201939182900301818588803b15801561199057600080fd5b612677614d73565b600f54600090819060ff1615156001146126c9576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b8015612710576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b34633b9aca00811015612768576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af68000008111156127b8576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b6127c18661098e565b336000908152600660205260409020549096509450600160a060020a03881615806127f45750600160a060020a03881633145b15612812576000858152600860205260409020600601549350612859565b600160a060020a0388166000908152600660208181526040808420548985526008909252909220015490945084146128595760008581526008602052604090206006018490555b61286287613632565b965061153185858989610c42565b600960209081526000928352604080842090915290825290208054600182015460028301546003909301549192909184565b6128aa614d73565b600f54600090819060ff1615156001146128fc576040805160e560020a62461bcd0281526020600482015260146024820152600080516020614ded833981519152604482015290519081900360640190fd5b33803b8015612943576040805160e560020a62461bcd0281526020600482015260116024820152600080516020614e2d833981519152604482015290519081900360640190fd5b34633b9aca0081101561299b576040805160e560020a62461bcd0281526020600482015260216024820152600080516020614dcd833981519152604482015260f860020a607902606482015290519081900360840190fd5b69152d02c7e14af68000008111156129eb576040805160e560020a62461bcd02815260206004820152600e6024820152600080516020614e0d833981519152604482015290519081900360640190fd5b6129f48661098e565b336000908152600660205260409020549096509450871580612a26575060008581526008602052604090206001015488145b15612a44576000858152600860205260409020600601549350612859565b600088815260076020908152604080832054888452600890925290912060060154909450841461285957600085815260086020526040902060060184905561286287613632565b600e602052600090815260409020805460019091015482565b6005546000818152600b60205260408120600201549091904290811015612b2a576002546000838152600b602052604090206004015401811115612b04576000828152600b6020526040902060020154610f2b908263ffffffff61425216565b6002546000838152600b6020526040902060040154610f2b91018263ffffffff61425216565b60009250610f3c565b6002546000838152600b6020526040812060040154909142910181118015612b9d57506000848152600b602052604090206002015481111580612b9d57506000848152600b602052604090206002015481118015612b9d57506000848152600b6020526040902054155b15612bcb576000848152600b6020526040902060060154612bc4908463ffffffff61430f16565b9150612bd4565b612bc483614330565b5092915050565b6005546002546000828152600b602052604081206004015490929142910181118015612c4957506000828152600b602052604090206002015481111580612c4957506000828152600b602052604090206002015481118015612c4957506000828152600b6020526040902054155b15612c7d576000828152600b6020526040902060050154612c76908590610f1f908263ffffffff6135a416565b9250612c86565b612c76846143a7565b5050919050565b600f5460ff1681565b60035481565b6008602052600090815260409020805460018201546002830154600384015460048501546005860154600690960154600160a060020a039095169593949293919290919087565b6000806000806000806000806000600554915050600160a060020a038916600090815260066020908152604080832054808452600880845282852060018082015460098752858820898952875294872001549583905293526002830154600590930154909384939091612d7990612d5b9086906142b2565b6000878152600860205260409020600301549063ffffffff6135a416565b600095865260086020908152604080882060040154600983528189209989529890915290952054939e929d50909b509950919750919550909350915050565b600085815260096020908152604080832089845290915281206001015481901515612dea57612de78784614414565b92505b633b9aca00861115611531576000888152600b6020526040902060060154612e18908763ffffffff61430f16565b9150670de0b6b3a76400008210612e8f57612e338289614473565b6000888152600b60205260409020548714612e5a576000888152600b602052604090208790555b6000888152600b60205260409020600101548414612e87576000888152600b602052604090206001018490555b825160640183525b67016345785d8a000086106130cf57600480546001019055612eaf61454f565b1515600114156130cf57678ac7230489e800008610612f5057600354606490612edf90604b63ffffffff61410d16565b811515612ee857fe5b6000898152600860205260409020600201549190049150612f0f908263ffffffff6135a416565b600088815260086020526040902060020155600354612f34908263ffffffff61425216565b60035582516d0eca8847c4129106ce83000000000183526130a4565b670de0b6b3a76400008610158015612f6f5750678ac7230489e8000086105b15612ffc57600354606490612f8b90603263ffffffff61410d16565b811515612f9457fe5b6000898152600860205260409020600201549190049150612fbb908263ffffffff6135a416565b600088815260086020526040902060020155600354612fe0908263ffffffff61425216565b60035582516d09dc5ada82b70b59df02000000000183526130a4565b67016345785d8a0000861015801561301b5750670de0b6b3a764000086105b156130a45760035460649061303790601963ffffffff61410d16565b81151561304057fe5b6000898152600860205260409020600201549190049150613067908263ffffffff6135a416565b60008881526008602052604090206002015560035461308c908263ffffffff61425216565b60035582516d0eca8847c4129106ce83000000000183525b82516d314dc6448d9338c15b0a000000008202016c7e37be2022c0914b268000000001835260006004555b60045483516103e890910201835260008781526009602090815260408083208b845290915290206001015461310b90839063ffffffff6135a416565b60008881526009602090815260408083208c845290915290206001810191909155546131389087906135a4565b60008881526009602090815260408083208c8452825280832093909355600b9052206005015461316f90839063ffffffff6135a416565b6000898152600b6020526040902060058101919091556006015461319a90879063ffffffff6135a416565b6000898152600b6020908152604080832060060193909355600c8152828220878352905220546131d190879063ffffffff6135a416565b6000898152600c602090815260408083208884529091529020556131f9888888888888614766565b9250613209888888878688614890565b925061153187858885876149be565b613220614d73565b6005546000818152600b602052604081208054600182015460079092015490928080808080606461325888603063ffffffff61410d16565b81151561326157fe5b049550603261327788600663ffffffff61410d16565b81151561328057fe5b60008a8152600e602052604090205491900495506064906132a890899063ffffffff61410d16565b8115156132b157fe5b0493506132ca84611d6787818b8b63ffffffff61425216565b60008b8152600b60205260409020600501549093506132f785670de0b6b3a764000063ffffffff61410d16565b81151561330057fe5b60008c8152600b6020526040902060050154919004925061334e90670de0b6b3a76400009061333690859063ffffffff61410d16565b81151561333f57fe5b8691900463ffffffff61425216565b9050600081111561337e57613369848263ffffffff61425216565b935061337b838263ffffffff6135a416565b92505b6000898152600860205260409020600201546133a190879063ffffffff6135a416565b60008a8152600860205260408082206002019290925580549151600160a060020a039092169187156108fc0291889190818181858888f193505050501580156133ee573d6000803e3d6000fd5b5060008a8152600b602052604090206008015461341290839063ffffffff6135a416565b600b60008c815260200190815260200160002060080181905550600b60008b815260200190815260200160002060020154620f4240028c60000151018c60000181815250508767016345785d8a000002896a52b7d2dcc80cd2e4000000028d6020015101018c6020018181525050600860008a815260200190815260200160002060000160009054906101000a9004600160a060020a03168c60400190600160a060020a03169081600160a060020a031681525050600860008a8152602001908152602001600020600101548c606001906000191690816000191681525050858c6080018181525050838c60e001818152505060008c60c0018181525050828c60a001818152505060056000815480929190600101919050555089806001019a505042600b60008c81526020019081526020016000206004018190555061357660025461356a610708426135a490919063ffffffff16565b9063ffffffff6135a416565b60008b8152600b6020526040902060028101919091556007018390558b9a5050505050505050505050919050565b818101828110156135ff576040805160e560020a62461bcd02815260206004820152601360248201527f536166654d61746820616464206661696c656400000000000000000000000000604482015290519081900360640190fd5b92915050565b600061362b61362261361d858563ffffffff61425216565b6143a7565b611d67856143a7565b9392505050565b6000808210806136425750600382115b1561364f57506002613652565b50805b919050565b6005546002546000828152600b6020526040902060040154429101811180156136c257506000828152600b6020526040902060020154811115806136c257506000828152600b6020526040902060020154811180156136c257506000828152600b6020526040902054155b156136f9576136d484611d6789613873565b6000888152600860205260409020600301556136f4828886898988612db8565b61189f565b6000828152600b60205260409020600201548111801561372b57506000828152600b602052604090206003015460ff16155b1561189f576000828152600b60205260409020600301805460ff1916600117905561375583613218565b925080670de0b6b3a764000002836000015101836000018181525050868360200151018360200181815250507f88261ac70d02d5ea73e54fa6da17043c974de1021109573ec1f6f57111c823dd33600860008a815260200190815260200160002060010154856000015186602001518760400151886060015189608001518a60a001518b60c001518c60e00151604051808b600160a060020a0316600160a060020a031681526020018a6000191660001916815260200189815260200188815260200187600160a060020a0316600160a060020a0316815260200186600019166000191681526020018581526020018481526020018381526020018281526020019a505050505050505050505060405180910390a150505050505050565b6000818152600860205260408120600501548190613892908490614b2c565b6000838152600860205260409020600481015460038201546002909201546138c49261356a919063ffffffff6135a416565b905060008111156138f05760008381526008602052604081206002810182905560038101829055600401555b8091505b50919050565b80516000908290828080602084118015906139155750600084115b1515613991576040805160e560020a62461bcd02815260206004820152602a60248201527f737472696e67206d757374206265206265747765656e203120616e642033322060448201527f6368617261637465727300000000000000000000000000000000000000000000606482015290519081900360840190fd5b8460008151811015156139a057fe5b90602001015160f860020a900460f860020a02600160f860020a031916602060f860020a0214158015613a07575084600185038151811015156139df57fe5b90602001015160f860020a900460f860020a02600160f860020a031916602060f860020a0214155b1515613a83576040805160e560020a62461bcd02815260206004820152602560248201527f737472696e672063616e6e6f74207374617274206f7220656e6420776974682060448201527f7370616365000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b846000815181101515613a9257fe5b90602001015160f860020a900460f860020a02600160f860020a031916603060f860020a021415613bd557846001815181101515613acc57fe5b90602001015160f860020a900460f860020a02600160f860020a031916607860f860020a0214151515613b49576040805160e560020a62461bcd02815260206004820152601b60248201527f737472696e672063616e6e6f7420737461727420776974682030780000000000604482015290519081900360640190fd5b846001815181101515613b5857fe5b90602001015160f860020a900460f860020a02600160f860020a031916605860f860020a0214151515613bd5576040805160e560020a62461bcd02815260206004820152601b60248201527f737472696e672063616e6e6f7420737461727420776974682030580000000000604482015290519081900360640190fd5b600091505b838210156140a55784517f400000000000000000000000000000000000000000000000000000000000000090869084908110613c1257fe5b90602001015160f860020a900460f860020a02600160f860020a031916118015613c86575084517f5b0000000000000000000000000000000000000000000000000000000000000090869084908110613c6757fe5b90602001015160f860020a900460f860020a02600160f860020a031916105b15613cf3578482815181101515613c9957fe5b90602001015160f860020a900460f860020a0260f860020a900460200160f860020a028583815181101515613cca57fe5b906020010190600160f860020a031916908160001a905350821515613cee57600192505b61409a565b8482815181101515613d0157fe5b90602001015160f860020a900460f860020a02600160f860020a031916602060f860020a021480613dd1575084517f600000000000000000000000000000000000000000000000000000000000000090869084908110613d5d57fe5b90602001015160f860020a900460f860020a02600160f860020a031916118015613dd1575084517f7b0000000000000000000000000000000000000000000000000000000000000090869084908110613db257fe5b90602001015160f860020a900460f860020a02600160f860020a031916105b80613e7b575084517f2f0000000000000000000000000000000000000000000000000000000000000090869084908110613e0757fe5b90602001015160f860020a900460f860020a02600160f860020a031916118015613e7b575084517f3a0000000000000000000000000000000000000000000000000000000000000090869084908110613e5c57fe5b90602001015160f860020a900460f860020a02600160f860020a031916105b1515613ef7576040805160e560020a62461bcd02815260206004820152602260248201527f737472696e6720636f6e7461696e7320696e76616c696420636861726163746560448201527f7273000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b8482815181101515613f0557fe5b90602001015160f860020a900460f860020a02600160f860020a031916602060f860020a021415613fe4578482600101815181101515613f4157fe5b90602001015160f860020a900460f860020a02600160f860020a031916602060f860020a0214151515613fe4576040805160e560020a62461bcd02815260206004820152602860248201527f737472696e672063616e6e6f7420636f6e7461696e20636f6e7365637574697660448201527f6520737061636573000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b82158015614090575084517f30000000000000000000000000000000000000000000000000000000000000009086908490811061401d57fe5b90602001015160f860020a900460f860020a02600160f860020a0319161080614090575084517f39000000000000000000000000000000000000000000000000000000000000009086908490811061407157fe5b90602001015160f860020a900460f860020a02600160f860020a031916115b1561409a57600192505b600190910190613bda565b6001831515146140ff576040805160e560020a62461bcd02815260206004820152601d60248201527f737472696e672063616e6e6f74206265206f6e6c79206e756d62657273000000604482015290519081900360640190fd5b505050506020015192915050565b600082151561411e575060006135ff565b5081810281838281151561412e57fe5b04146135ff576040805160e560020a62461bcd02815260206004820152601360248201527f536166654d617468206d756c206661696c656400000000000000000000000000604482015290519081900360640190fd5b60008281526009602090815260408083208484528252808320600190810154600b8085528386206005810154938101548752600e8652938620548787529452600790920154670de0b6b3a764000093614241939261423592909161420c9187916064916141f69163ffffffff61410d16565b8115156141ff57fe5b049063ffffffff61410d16565b81151561421557fe5b6000888152600b602052604090206008015491900463ffffffff6135a416565b9063ffffffff61410d16565b81151561424a57fe5b049392505050565b6000828211156142ac576040805160e560020a62461bcd02815260206004820152601360248201527f536166654d61746820737562206661696c656400000000000000000000000000604482015290519081900360640190fd5b50900390565b600082815260096020908152604080832084845282528083206002810154600190910154600b9093529083206008015461362b92670de0b6b3a7640000916142f99161410d565b81151561430257fe5b049063ffffffff61425216565b600061362b61431d84614330565b611d67614330868663ffffffff6135a416565b60006304a817c86143976d01d950e8a8b3f3e2b4cdfef00000611d676143927a036b1c1551a5dde9848bb90c4375b051041403ca4121000000000061356a6a813f3978f89409844000006142358a670de0b6b3a764000063ffffffff61410d16565b614bc3565b8115156143a057fe5b0492915050565b60006143ba670de0b6b3a7640000614c16565b61439760026143ed6143da86670de0b6b3a764000063ffffffff61410d16565b65443647b398389063ffffffff61410d16565b8115156143f657fe5b0461356a61440386614c16565b6302540be49063ffffffff61410d16565b61441c614d73565b6000838152600860205260409020600501541561445057600083815260086020526040902060050154614450908490614b2c565b506005805460009384526008602052604090932001919091558051600a01815290565b6000818152600b6020526040812060020154429190821180156144a257506000838152600b6020526040902054155b156144c6576144bf8261356a600a670de0b6b3a7640000886141ff565b90506144f3565b6000838152600b60205260409020600201546144f09061356a600a670de0b6b3a7640000886141ff565b90505b614505610e108363ffffffff6135a416565b811015614525576000838152600b60205260409020600201819055611c4c565b614537610e108363ffffffff6135a416565b6000848152600b602052604090206002015550505050565b6000806146c04361356a42336040516020018082600160a060020a0316600160a060020a03166c010000000000000000000000000281526014019150506040516020818303038152906040526040518082805190602001908083835b602083106145ca5780518252601f1990920191602091820191016145ab565b5181516020939093036101000a600019018019909116921691909117905260405192018290039091209250505081151561460057fe5b0461356a4561356a42416040516020018082600160a060020a0316600160a060020a03166c010000000000000000000000000281526014019150506040516020818303038152906040526040518082805190602001908083835b602083106146795780518252601f19909201916020918201910161465a565b5181516020939093036101000a60001901801990911692169190911790526040519201829003909120925050508115156146af57fe5b0461356a424463ffffffff6135a416565b604051602001808281526020019150506040516020818303038152906040526040518082805190602001908083835b6020831061470e5780518252601f1990920191602091820191016146ef565b5181516020939093036101000a6000190180199091169216919091179052604051920182900390912060045490945092506103e89150839050046103e8028203101561475d5760019150614762565b600091505b5090565b61476e614d73565b6032850460058604858814801590614796575060008681526008602052604090206001015415155b15614836576000868152600860205260409020600401546147be90829063ffffffff6135a416565b600087815260086020908152604091829020600481019390935582546001909301548251600160a060020a039094168452908301528181018390524260608301525189918b9189917f590bbc0fc16915a85269a48f74783c39842b7ae9eceb7c295c95dbe8b3ec7331919081900360800190a4614849565b614846828263ffffffff6135a416565b91505b60008054604051600160a060020a039091169184156108fc02918591818181858888f19350505050158015614882573d6000803e3d6000fd5b509298975050505050505050565b614898614d73565b6000848152600d60205260408120548190819081906064906148c1908b9063ffffffff61410d16565b8115156148ca57fe5b0493506032890492506148e8836003546135a490919063ffffffff16565b60035561491960646149018b601863ffffffff61410d16565b81151561490a57fe5b8b91900463ffffffff61425216565b985061492b898563ffffffff61425216565b91506149398b8b868a614c22565b9050600081111561495757614954848263ffffffff61425216565b93505b60008b8152600b602052604090206007015461497d9061356a848463ffffffff6135a416565b60008c8152600b602052604090206007015560e08601516149a590859063ffffffff6135a416565b60e0870152506101008501525091979650505050505050565b836c01431e0fae6d7217caa00000000242670de0b6b3a76400000282600001510101816000018181525050600554751aba4714957d300d0e549208b31adb100000000000000285826020015101018160200181815250507f500e72a0e114930aebdbcb371ccdbf43922c49f979794b5de4257ff7e310c7468160000151826020015160086000898152602001908152602001600020600101543387878760400151886060015189608001518a60a001518b60c001518c60e001518d6101000151600354604051808f81526020018e81526020018d600019166000191681526020018c600160a060020a0316600160a060020a031681526020018b81526020018a815260200189600160a060020a0316600160a060020a0316815260200188600019166000191681526020018781526020018681526020018581526020018481526020018381526020018281526020019e50505050505050505050505050505060405180910390a15050505050565b6000614b3883836142b2565b90506000811115614bbe57600083815260086020526040902060030154614b6690829063ffffffff6135a416565b6000848152600860209081526040808320600301939093556009815282822085835290522060020154614ba090829063ffffffff6135a416565b60008481526009602090815260408083208684529091529020600201555b505050565b6000806002614bd38460016135a4565b811515614bdc57fe5b0490508291505b818110156138f4578091506002614c058285811515614bfe57fe5b04836135a4565b811515614c0e57fe5b049050614be3565b60006135ff828361410d565b6000848152600b602052604081206005015481908190614c5086670de0b6b3a764000063ffffffff61410d16565b811515614c5957fe5b6000898152600b60205260409020600801549190049250614c8190839063ffffffff6135a416565b6000888152600b6020526040902060080155670de0b6b3a7640000614cac838663ffffffff61410d16565b811515614cb557fe5b60008881526009602090815260408083208c8452825280832060020154600b90925290912060080154929091049250614d089161356a908490670de0b6b3a7640000906142f9908a63ffffffff61410d16565b60008781526009602090815260408083208b8452825280832060020193909355600b90522060050154614d6890670de0b6b3a764000090614d5090859063ffffffff61410d16565b811515614d5957fe5b8791900463ffffffff61425216565b979650505050505050565b6101206040519081016040528060008152602001600081526020016000600160a060020a0316815260200160008019168152602001600081526020016000815260200160008152602001600081526020016000815250905600706f636b6574206c696e743a206e6f7420612076616c69642063757272656e63697473206e6f74207265616479207965742e20200000000000000000000000006e6f20766974616c696b2c206e6f000000000000000000000000000000000000736f7272792068756d616e73206f6e6c79000000000000000000000000000000a165627a7a723058205ff46a529f5a286a66a2c5105ebb40d03b777c42e1a9d968afd1f2c5330dfd420029"
	runCfgAnly("CfgFailure", s)
}

func worker(code []byte) {
	metrics := vm.CfgMetrics{}
	mon := make(chan int, 1)

	start := time.Now()

	go func() {
		cfg, _ := vm.GenCfg(code, maxAnlyCounterLimit, maxStackLen, maxStackCount, &metrics)
		if cfg.Metrics.Valid {
			proof := cfg.GenerateProof()
			sfa := vm.StorageFlowAnalysis(code, proof)

			cfg.ProofSerialized = proof.Serialize()
			dproof := vm.DeserializeCfgProof(cfg.ProofSerialized)
			check := vm.CheckCfg(code, dproof)
			metrics.CheckerFailed = !check
			metrics.ProofSizeBytes = len(cfg.ProofSerialized)
			metrics.IsStaticStateAccess = sfa.IsStaticStateAccess
		}

		mon <- 0
	}()

	oom := make(chan int, 1)

	go func() {
		for {
			var m runtime.MemStats
			runtime.ReadMemStats(&m)
			// For info on each, see: https://golang.org/pkg/runtime/#MemStats
			if !*quiet {
				fmt.Printf("Alloc = %v MiB", bToMb(m.Alloc))
				fmt.Printf("\tTotalAlloc = %v MiB", bToMb(m.TotalAlloc))
				fmt.Printf("\tSys = %v MiB", bToMb(m.Sys))
				fmt.Printf("\tNumGC = %v\n", m.NumGC)
			}
			time.Sleep(10 * time.Second)

			metrics.MemUsedMBs = bToMb(m.Alloc)
			if metrics.MemUsedMBs > maxMBs {
				oom <- 0
			}
		}
	}()

	select {
	case <-mon:
		if !*quiet {
			fmt.Printf("Done\n")
		}
		metrics.Time = time.Since(start)
	case <-time.After(time.Duration(maxSecs) * time.Second):
		if !*quiet {
			fmt.Printf("Timed out\n")
		}
		metrics.Timeout = true
		metrics.Time = time.Since(start)
	case <-oom:
		if !*quiet {
			fmt.Printf("OOM\n")
		}
		metrics.OOM = true
	}

	b, err := json.Marshal(metrics)
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Printf("%v", string(b))
}

func bToMb(b uint64) uint64 {
	return b / 1024 / 1024
}

func batchServer() {
	numWorkers := runtime.NumCPU() - 2
	fmt.Printf("Number of cores: %v\n", numWorkers)

	file, err := os.Open("absintdata/contract_bytecode_txcnt.csv")
	//file, err := os.Open("/Users/suhabebugrara/absintdata/small_imprecision.csv")
	if err != nil {
		log.Fatalf("failed opening file: %s", err)
	}
	scanner := bufio.NewScanner(file)
	scanner.Split(bufio.ScanLines)
	scanner.Scan() //remove header
	jobList := make([]*cfgJob, 0)
	for scanner.Scan() {
		line := scanner.Text()
		if len(strings.TrimSpace(line)) == 0 {
			continue
		}
		row := strings.Split(line, ",")
		txcnt, perr := strconv.ParseInt(row[0], 10, 64)
		check(perr)

		code, _ := hex.DecodeString(row[1][2:])
		jobList = append(jobList, &cfgJob{int(txcnt), code})
	}
	file.Close()
	fmt.Printf("Finished parsing %v jobs\n", len(jobList))

	jobs := make(chan *cfgJob, len(jobList))
	results := make(chan *cfgJobResult, len(jobList))

	for j := 0; j < len(jobList); j++ {
		jobs <- jobList[j]
	}
	close(jobs)
	fmt.Printf("Closing jobs\n")

	for i := 0; i < numWorkers; i++ {
		go func(id int) {
			for job := range jobs {
				enc := hex.EncodeToString(job.code)
				cmd := exec.Command("./build/bin/hack",
					"--action", "cfg",
					"--mode", "worker",
					"--quiet",
					"--bytecode", enc)

				metrics := vm.CfgMetrics{}
				out, oerr := cmd.Output()
				if oerr == nil {
					lines := strings.Split(string(out), "\n")
					merr := json.Unmarshal([]byte(lines[len(lines)-1]), &metrics)
					if merr != nil {
						fmt.Printf("Output:\n")
						fmt.Printf("%v\n", string(out))
						fmt.Printf("Bytecode:\n")
						fmt.Printf("%v %v\n", id, hex.EncodeToString(job.code))
						panic(merr)
					}
				} else {
					fmt.Println("Warning: Could not get output for " + hex.EncodeToString(job.code))
				}
				results <- &cfgJobResult{job, &metrics}
			}
		}(i)
	}

	current := time.Now()
	timestamp := current.Format("2006-01-02_15-04-05")
	filename := fmt.Sprintf("results_%v.csv", timestamp)
	fmt.Printf("Writing results to %v\n", filename)
	resultsFile, err := os.Create(filename)
	check(err)
	headers := []string{"TxCount",
		"BytecodeLen",
		"Valid",
		"BadJumpReason",
		"StackCountLimitReached",
		"ShortStack",
		"Timeout",
		"OOM",
		"Elapsed (ms)",
		"MemUsed (MB)",
		"Checker",
		"ProofSize (bytes)",
		"SSA?",
		"Bytecode"}
	_, err = resultsFile.WriteString(strings.Join(headers, "|") + "\n")
	check(err)
	err = resultsFile.Sync()
	check(err)

	eval := CfgEval{numPrograms: 191400}
	//numJobs := len(jobList)
	numJobs := len(jobList)
	for j := 0; j < numJobs; j++ {
		result := <-results

		line := []string{si(result.job.txcnt),
			si(len(result.job.code)),
			sb(result.metrics.Valid),
			result.metrics.GetBadJumpReason(),
			sb(result.metrics.StackCountLimitReached),
			sb(result.metrics.ShortStack),
			sb(result.metrics.Timeout),
			sb(result.metrics.OOM),
			si64(result.metrics.Time.Milliseconds()),
			sui64(result.metrics.MemUsedMBs),
			sb(result.metrics.Checker),
			si(result.metrics.ProofSizeBytes),
			sb(result.metrics.IsStaticStateAccess),
			hex.EncodeToString(result.job.code)}

		_, err = resultsFile.WriteString(strings.Join(line, "|") + "\n")
		check(err)

		err = resultsFile.Sync()
		check(err)

		eval.update(result, 1)

		if eval.numProgramsAnalyzed%10 == 0 {
			eval.printStats()
		}
	}
}

func si64(n int64) string {
	return fmt.Sprintf("%v", n)
}

func sui64(n uint64) string {
	return fmt.Sprintf("%v", n)
}

/*
func cfg0Test0() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x1, 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func cfg0Test1() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x2, byte(vm.PUSH1), 0x0, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func dfTest0() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x2, byte(vm.PUSH1), 0x0, 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func dfTest1() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x2, byte(vm.PUSH1), 0x0, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func dfTest2() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x2, byte(vm.PUSH1), 0x6, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func dfTest3() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}
//should fail to find concrete jump
func absIntTest1() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

//should fail to find concrete jump
func absIntTest2() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x0, byte(vm.JUMP), 0x0}
	vm.AbsIntCfgHarness(contract, 0, 64)
}

func absIntTest3() {
	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, false)
	contract.Code = []byte{byte(vm.PUSH1), 0x1,
		byte(vm.PUSH1), 0x55,
		byte(vm.MLOAD),
		byte(vm.LT),
		byte(vm.PUSH1), 0x0, //jump destination
		byte(vm.JUMPI),
		byte(vm.STOP)}
	vm.AbsIntCfgHarness(contract, 0, 64)
}
*/

func absIntAndJumpImprecision() {
	const s = "6080604052600436106100775763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166329cb924d811461015f578063520ab54d146101865780636f7bc9be146101a757806378e97925146101f05780638f84aa0914610205578063f3f7d63314610236575b336000908152602081905260409020662386f26fc10000341061012757600354600160a060020a03166108fc6100c560646100b934600a63ffffffff61024b16565b9063ffffffff61028416565b6040518115909202916000818181858888f193505050501580156100ed573d6000803e3d6000fd5b50805415156100ff5760018054810190555b610108336102a7565b805461011a903463ffffffff61039316565b815542600182015561015c565b3466038d7ea4c6800014156101535761013f336102a7565b60038101805460ff1916600117905561015c565b61015c336102a7565b50005b34801561016b57600080fd5b506101746103a5565b60408051918252519081900360200190f35b34801561019257600080fd5b50610174600160a060020a03600435166103a9565b3480156101b357600080fd5b506101c8600160a060020a0360043516610486565b6040805194855260208501939093528383019190915215156060830152519081900360800190f35b3480156101fc57600080fd5b506101746104b0565b34801561021157600080fd5b5061021a6104b6565b60408051600160a060020a039092168252519081900360200190f35b34801561024257600080fd5b506101746104c5565b60008083151561025e576000915061027d565b5082820282848281151561026e57fe5b041461027957600080fd5b8091505b5092915050565b60008080831161029357600080fd5b828481151561029e57fe5b04949350505050565b600160a060020a0381166000908152602081905260408120906102c9836103a9565b9050600082600001541180156102df5750600081115b1561038e5730318111156102f1575030315b6002820154610306908263ffffffff61039316565b6002830155426001830155815461032b906064906100b990609b63ffffffff61024b16565b60028301541061035f5760008083556001808401829055600284019190915560038301805460ff1916905580546000190190555b604051339082156108fc029083906000818181858888f1935050505015801561038c573d6000803e3d6000fd5b505b505050565b60008282018381101561027957600080fd5b4290565b600160a060020a038116600090815260208190526040812060018101548290819081906103e490603c906100b990429063ffffffff6104cb16565b600385015490935060ff161561044b57600091506105a08310610407576105a091505b61044462dbba006100b9856104386104296105a084848a63ffffffff6104cb16565b8954906004026101900161024b565b9063ffffffff61024b16565b945061047d565b8354610465906064906100b990600463ffffffff61024b16565b90506104446105a06100b9838663ffffffff61024b16565b50505050919050565b60006020819052908152604090208054600182015460028301546003909301549192909160ff1684565b60025481565b600354600160a060020a031681565b60015481565b600080838311156104db57600080fd5b50509003905600a165627a7a7230582003e15824efbf4304f8ab122e9796d73f32a7330964528bf24ac011046e16f1070029"
	runCfgAnly("AndJumpImprecision00", s)
}

//17891 transactions, 588 bytecode len
func absIntTestSmallImprecision2() {
	const s = "6080604052600436106100405763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166393e84cd98114610045575b600080fd5b34801561005157600080fd5b5061005a61005c565b005b60008060008060008060008060008060008060008073a62142888aba8370742be823c1782d17a0389da173ffffffffffffffffffffffffffffffffffffffff1663747dff426040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004016101c060405180830381600087803b1580156100ea57600080fd5b505af11580156100fe573d6000803e3d6000fd5b505050506040513d6101c081101561011557600080fd5b8101908080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291905050509d509d509d509d509d509d509d509d509d509d509d509d509d509d508673ffffffffffffffffffffffffffffffffffffffff167318a0451ea56fd4ff58f59837e9ec30f346ffdca573ffffffffffffffffffffffffffffffffffffffff161415151561021057fe5b50505050505050505050505050505600a165627a7a72305820ec5e1703d3b74688c3350622a2bcfc097615733fa5f8df7adf51d66ebf42d0260029"
	runCfgAnly("SmallImprecision02", s)
}

func absIntTestSmallImprecision() {
	const s = "5b7355173aca573ab872c570056d929d89f6babc3fb53156"
	runCfgAnly("SmallImprecision01", s)

}

func absIntTestSmallInvalidJumpDest() {
	const s = "60606040526008565b600256"
	runCfgAnly("SmallInvalidJumpDest", s)
}

/*
func absIntTestSmall00() {
	const s = "3360601c62c90bc318585733ff"
	runCfgAnly("Small00", s)

}*/

func absIntTestPanic00() {

	const s = "366000803761100060003660007302d808ee97204b6f2463c2f4af478ee5c9f1b4e95af43d6000803e80600081146053573d6000f35b3d6000fd"
	runCfgAnly("Panic00", s)
}

func absIntTestSimple00() {
	/*
		pragma solidity ^0.6.0;
		contract simple00 {
		    function execute() public returns (uint) {
		        return 5;
		    }
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060285760003560e01c80636146195414602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000600590509056fea2646970667358221220e2d6ab235a595eb0ea85f8cc9c54b34e1b4fb7b8f0446851d77e72e6d973b15364736f6c634300060c0033"
	runCfgAnly("Simple00", s)
}

func absIntTestDiv00() {
	/*
		pragma solidity ^0.6.0;
		contract div00 {
		    function execute(uint i) pure public returns (uint) {
		        return 3 / i;
		    }
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060285760003560e01c8063fe0d94c114602d575b600080fd5b605660048036036020811015604157600080fd5b8101908080359060200190929190505050606c565b6040518082815260200191505060405180910390f35b600081600381607757fe5b04905091905056fea2646970667358221220b094fe68fc0d94f35a01aa902290c8244fecb2ad6d1e773d7be369553fd8d48264736f6c63430006060033"
	runCfgAnly("Div00", s)
}

func absIntTestRequires00() {
	/*
		pragma solidity 0.4.24;
		contract requires00 {
			function execute(uint256 a0) public returns (address) {
				require(a0 > 0);
				return 5;
			}
		}
	*/
	const s = "608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063fe0d94c1146044575b600080fd5b348015604f57600080fd5b50606c6004803603810190808035906020019092919050505060ae565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6000808211151560bd57600080fd5b600590509190505600a165627a7a723058206e2f5feea3d6988c01bdd0e633ee0b3ee25e22144b361f39e79d525ce072ae7b0029"
	runCfgAnly("Requires00", s)
}

func absIntTestStoreDynamic00() {
	/*
	pragma solidity 0.4.24;

	contract storedyn00 {
	    mapping(address => uint256) public map;
	    address owner;

		function getOwnerValue() view public returns (uint256) {
		    return map[owner];
		}
	}
	*/
	const s = "60806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063b721ef6e14610051578063c9885b76146100a8575b600080fd5b34801561005d57600080fd5b50610092600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506100d3565b6040518082815260200191505060405180910390f35b3480156100b457600080fd5b506100bd6100eb565b6040518082815260200191505060405180910390f35b60006020528060005260406000206000915090505481565b6000806000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050905600a165627a7a723058207f1ae32c16e4c5cd09e96a557c0a8dac77b64918f77fd7ba93223b2ae189d97a0029"
	runCfgAnly("StoreDynamic00", s)
}


func absIntTestStorageIntoMemory() {
	/*
		pragma solidity 0.6.12;

		contract storageIntoMem {
		    uint256 value;

			function getValue() public returns (uint256) {
			    return value;
			}
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060285760003560e01c80632096525514602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000805490509056fea264697066735822122064522fa596c78dec8ab0aee5f0d05fe19c52053c12688cc3858aef2f5600766f64736f6c634300060c0033"
	runCfgAnly("StorageIntoMemory", s)
}


func absIntTestERC20min() {
	const s = "608060405234801561001057600080fd5b506004361061002b5760003560e01c8063a9059cbb14610030575b600080fd5b61007c6004803603604081101561004657600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610094565b60405180821515815260200191505060405180910390f35b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548211156100e157600080fd5b610132826000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461021190919063ffffffff16565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506101c5826000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461022890919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506001905092915050565b60008282111561021d57fe5b818303905092915050565b60008082840190508381101561023a57fe5b809150509291505056fea2646970667358221220469f70d678fd20faf44aa5c1df0edc5308b6d58c21f20e889e9f6e9e731d5cf264736f6c634300060c0033"
	runCfgAnly("ERC20 min", s)
}

func absIntTestERC20() {
	/*

	*/
	const s = "608060405234801561001057600080fd5b50600436106100935760003560e01c8063313ce56711610066578063313ce5671461022157806370a082311461024257806395d89b411461029a578063a9059cbb1461031d578063dd62ed3e1461038157610093565b806306fdde0314610098578063095ea7b31461011b57806318160ddd1461017f57806323b872dd1461019d575b600080fd5b6100a06103f9565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e05780820151818401526020810190506100c5565b50505050905090810190601f16801561010d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101676004803603604081101561013157600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610432565b60405180821515815260200191505060405180910390f35b610187610524565b6040518082815260200191505060405180910390f35b610209600480360360608110156101b357600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061052e565b60405180821515815260200191505060405180910390f35b6102296108a9565b604051808260ff16815260200191505060405180910390f35b6102846004803603602081101561025857600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506108ae565b6040518082815260200191505060405180910390f35b6102a26108f6565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102e25780820151818401526020810190506102c7565b50505050905090810190601f16801561030f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6103696004803603604081101561033357600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061092f565b60405180821515815260200191505060405180910390f35b6103e36004803603604081101561039757600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610b11565b6040518082815260200191505060405180910390f35b6040518060400160405280600a81526020017f455243323042617369630000000000000000000000000000000000000000000081525081565b600081600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a36001905092915050565b6000600254905090565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561057b57600080fd5b600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561060457600080fd5b610655826000808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610b9890919063ffffffff16565b6000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555061072682600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610b9890919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506107f7826000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610baf90919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a3600190509392505050565b601281565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6040518060400160405280600381526020017f425343000000000000000000000000000000000000000000000000000000000081525081565b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111561097c57600080fd5b6109cd826000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610b9890919063ffffffff16565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610a60826000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610baf90919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a36001905092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600082821115610ba457fe5b818303905092915050565b600080828401905083811015610bc157fe5b809150509291505056fea264697066735822122024232ccec52eb62ccf9b062595e5bec1f3fccef9e46d6bf40ad43d60ac49b9ad64736f6c634300060c0033"
	runCfgAnly("ERC20", s)
}

func absIntTestCall01() {
	/*
		pragma solidity 0.5.0;
		contract call01 {
		    uint public nonce;

		    function execute(bool condition, uint gasLimit, uint value, bytes memory data, address destination) public {
		        require(condition);
		        nonce = nonce + 1;
		        bool success = false;
		        assembly { success := call(gasLimit, destination, value, add(data, 0x20), mload(data), 0, 0) }
		        require(success);
		    }
		}
	*/
	const s = "60806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806361fa2d7114610051578063affed0e014610159575b600080fd5b34801561005d57600080fd5b50610157600480360360a081101561007457600080fd5b810190808035151590602001909291908035906020019092919080359060200190929190803590602001906401000000008111156100b157600080fd5b8201836020820111156100c357600080fd5b803590602001918460018302840111640100000000831117156100e557600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610184565b005b34801561016557600080fd5b5061016e6101c4565b6040518082815260200191505060405180910390f35b84151561019057600080fd5b600160005401600081905550600080905060008084516020860187868af190508015156101bc57600080fd5b505050505050565b6000548156fea165627a7a723058206ad69eb8bdde0a17439a080093eb09b7f9cb9f2c8ecc602773db3599cde132f10029"
	runCfgAnly("Call01", s)
}

func absIntTestEcrecoverLoop02() {
	/*
		pragma solidity 0.5.0;
		contract ecrecoverloop02 {
		    function execute(bytes32 hash, bytes memory data,
		                     uint8[2] memory sigV, bytes32[2] memory sigR, bytes32[2] memory sigS) pure public {
		        for (uint i = 0; i < 2; i++) {
		            address recovered = ecrecover(hash, sigV[i], sigR[i], sigS[i]);
		            require(recovered > address(0));
		        }
		    }
		}
	*/
	const s = "608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633543d4b214610046575b600080fd5b34801561005257600080fd5b506101da600480360361010081101561006a57600080fd5b81019080803590602001909291908035906020019064010000000081111561009157600080fd5b8201836020820111156100a357600080fd5b803590602001918460018302840111640100000000831117156100c557600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929080604001906002806020026040519081016040528092919082600260200280828437600081840152601f19601f820116905080830192505050505050919291929080604001906002806020026040519081016040528092919082600260200280828437600081840152601f19601f820116905080830192505050505050919291929080604001906002806020026040519081016040528092919082600260200280828437600081840152601f19601f82011690508083019250505050505091929192905050506101dc565b005b60008090505b60028110156102d557600060018786846002811015156101fe57fe5b6020020151868560028110151561021157fe5b6020020151868660028110151561022457fe5b602002015160405160008152602001604052604051808581526020018460ff1660ff1681526020018381526020018281526020019450505050506020604051602081039080840390855afa158015610280573d6000803e3d6000fd5b505050602060405103519050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161115156102c757600080fd5b5080806001019150506101e2565b50505050505056fea165627a7a723058200e559ecf0b4ed3978069fd9e401adb4043ef711a33a5926f0e081d7bcdf08bb80029"
	runCfgAnly("EcrecoverLoop02", s)
}

func absIntTestStorageVar03() {
	/*
		pragma solidity 0.5.0;
		contract storagevar03 {
		    uint private n;

		    function execute() public returns(uint) {
		        n = 5;
		        require(false);
		    }
		}
	*/
	const s = "608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806361461954146044575b600080fd5b348015604f57600080fd5b506056606c565b6040518082815260200191505060405180910390f35b6000600560008190555060001515608257600080fd5b9056fea165627a7a723058206c2e2e763fa3e914d5806ac22d4cf3bd0ff53cd57740965d5e5d05934668a9110029"
	runCfgAnly("StorageVar03", s)
}

func absIntTestStaticLoop00() {
	/*
		pragma solidity 0.5.0;
		contract staticloop00 {
		    function execute(uint a0) pure external returns(uint256) {
		        uint sum = a0;
		        require (a0 < 10);
		        for (uint i = 0; i < 3; i++) {
		            sum += i;
		        }
		        return sum;
		    }
		}
	*/
	const s = "608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063fe0d94c1146044575b600080fd5b348015604f57600080fd5b50607960048036036020811015606457600080fd5b8101908080359060200190929190505050608f565b6040518082815260200191505060405180910390f35b600080829050600a8310151560a357600080fd5b60008090505b600381101560c2578082019150808060010191505060a9565b508091505091905056fea165627a7a72305820e9eae4d836605e8f28df860b8f590e6cd933ddcbf111d99767c764aa99f093900029"
	runCfgAnly("StaticLoop00", s)
}

func runCfgAnly(testName string, code string) {
	decoded, derr := hex.DecodeString(code)
	if derr != nil {
		log.Fatal(derr)
	}

	metrics := vm.CfgMetrics{}
	cfg, err := vm.GenCfg(decoded, 0, maxStackLen, maxStackCount, &metrics)
	cfg.PrintAnlyState()
	if !cfg.Metrics.Valid || err != nil {
		fmt.Printf("Test failed: %v %v\n", testName, err)
		fmt.Printf("Bad jump reason: %v\n", cfg.Metrics.GetBadJumpReason())
		fmt.Printf("# bad jumps: %v\n", len(cfg.BadJumps))
	} else {
		fmt.Printf("Test passed: %v Covered=%v Instructions=%v Uncovered=%v Epilogue=%v\n",
			testName,
			cfg.GetCoverageStats().Covered,
			cfg.GetCoverageStats().Instructions,
			cfg.GetCoverageStats().Uncovered,
			cfg.GetCoverageStats().Epilogue)

		proof := cfg.GenerateProof()
		//fmt.Printf("%v\n", proof.ToString())
		sfa := vm.StorageFlowAnalysis(decoded, proof)
		fmt.Printf("ssa? %v", sfa.IsStaticStateAccess)

		/*
				cfg.ProofSerialized = proof.Serialize()
				fmt.Printf("Proof:\n%+v\n", string(cfg.ProofSerialized))

				dproof := vm.DeserializeCfgProof(cfg.ProofSerialized)

				check := vm.CheckCfg(decoded, dproof)
				if check {
					fmt.Printf("Proof checker successfully checked proof")
				} else {
					fmt.Printf("Proof checker failed to check proof")
				}*/
	}
}

func absIntTestStaticLoop01() {
	/*
		pragma solidity 0.5.0;
		contract staticloop00 {
		    function execute(uint a0) pure external returns(uint256) {
		        uint sum = a0;
		        for (uint i = 0; i < 1; i++) {
		            sum += i;
		        }
		        return sum;
		    }
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060285760003560e01c8063fe0d94c114602d575b600080fd5b605660048036036020811015604157600080fd5b8101908080359060200190929190505050606c565b6040518082815260200191505060405180910390f35b60008082905060008090505b6001811015609157808201915080806001019150506078565b508091505091905056fea26469706673582212206a12d74a991e3b9cbf04e5abed951fe8a0042780f7a9fe889fd798624b44be1264736f6c63430006060033"
	runCfgAnly("StaticLoop01", s)
}

func absIntTestPrivateFunction01() {
	/*
		pragma solidity ^0.6.6;
		contract PrivateFunction {
			function f(uint a0) pure private {
				require (a0 < 10);
			}
			function execute(uint a0) pure external returns(uint256) {
			   f(a0);
			   a0 = a0 + 1;
			   f(a0);
			}
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060285760003560e01c8063fe0d94c114602d575b600080fd5b605660048036036020811015604157600080fd5b8101908080359060200190929190505050606c565b6040518082815260200191505060405180910390f35b60006075826087565b6001820191506082826087565b919050565b600a8110609357600080fd5b5056fea26469706673582212201621427408bf92a9a07dd10d32e63a8421461a0778eeaba88b9fd84e3769b5ca64736f6c63430006060033"
	runCfgAnly("PrivateFunction01", s)
}

func absIntTestPrivateFunction02() {
	/*
		pragma solidity 0.6.12;
		contract DepositContract {
			function get_deposit_root(bytes32 node) external view returns (uint64) {
				return to_little_endian_64();
			}
			function get_deposit_count() external view returns (uint64) {
				return to_little_endian_64();
			}
			function to_little_endian_64() internal pure returns (uint64) {
				return 15;
			}
		}
	*/
	const s = "6080604052348015600f57600080fd5b506004361060325760003560e01c8063621fd130146037578063da36c6a314605d575b600080fd5b603d60a6565b604051808267ffffffffffffffff16815260200191505060405180910390f35b608660048036036020811015607157600080fd5b810190808035906020019092919050505060b3565b604051808267ffffffffffffffff16815260200191505060405180910390f35b600060ae60c2565b905090565b600060bb60c2565b9050919050565b6000600f90509056fea264697066735822122002e819f5f340845231359a0b3bc4134fb1daff9c5397e4c6d3101e54d0cdee0b64736f6c634300060c0033"
	runCfgAnly("PrivateFunction02", s)
}

func absIntTestDepositContract() {
	const s = "60806040526004361061003f5760003560e01c806301ffc9a71461004457806322895118146100a4578063621fd130146101ba578063c5f2892f14610244575b600080fd5b34801561005057600080fd5b506100906004803603602081101561006757600080fd5b50357fffffffff000000000000000000000000000000000000000000000000000000001661026b565b604080519115158252519081900360200190f35b6101b8600480360360808110156100ba57600080fd5b8101906020810181356401000000008111156100d557600080fd5b8201836020820111156100e757600080fd5b8035906020019184600183028401116401000000008311171561010957600080fd5b91939092909160208101903564010000000081111561012757600080fd5b82018360208201111561013957600080fd5b8035906020019184600183028401116401000000008311171561015b57600080fd5b91939092909160208101903564010000000081111561017957600080fd5b82018360208201111561018b57600080fd5b803590602001918460018302840111640100000000831117156101ad57600080fd5b919350915035610304565b005b3480156101c657600080fd5b506101cf6110b5565b6040805160208082528351818301528351919283929083019185019080838360005b838110156102095781810151838201526020016101f1565b50505050905090810190601f1680156102365780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561025057600080fd5b506102596110c7565b60408051918252519081900360200190f35b60007fffffffff0000000000000000000000000000000000000000000000000000000082167f01ffc9a70000000000000000000000000000000000000000000000000000000014806102fe57507fffffffff0000000000000000000000000000000000000000000000000000000082167f8564090700000000000000000000000000000000000000000000000000000000145b92915050565b6030861461035d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001806118056026913960400191505060405180910390fd5b602084146103b6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252603681526020018061179c6036913960400191505060405180910390fd5b6060821461040f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001806118786029913960400191505060405180910390fd5b670de0b6b3a7640000341015610470576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001806118526026913960400191505060405180910390fd5b633b9aca003406156104cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260338152602001806117d26033913960400191505060405180910390fd5b633b9aca00340467ffffffffffffffff811115610535576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602781526020018061182b6027913960400191505060405180910390fd5b6060610540826114ba565b90507f649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c589898989858a8a6105756020546114ba565b6040805160a0808252810189905290819060208201908201606083016080840160c085018e8e80828437600083820152601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01690910187810386528c815260200190508c8c808284376000838201819052601f9091017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01690920188810386528c5181528c51602091820193918e019250908190849084905b83811015610648578181015183820152602001610630565b50505050905090810190601f1680156106755780820380516001836020036101000a031916815260200191505b5086810383528881526020018989808284376000838201819052601f9091017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169092018881038452895181528951602091820193918b019250908190849084905b838110156106ef5781810151838201526020016106d7565b50505050905090810190601f16801561071c5780820380516001836020036101000a031916815260200191505b509d505050505050505050505050505060405180910390a1600060028a8a600060801b604051602001808484808284377fffffffffffffffffffffffffffffffff0000000000000000000000000000000090941691909301908152604080517ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0818403018152601090920190819052815191955093508392506020850191508083835b602083106107fc57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016107bf565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610859573d6000803e3d6000fd5b5050506040513d602081101561086e57600080fd5b5051905060006002806108846040848a8c6116fe565b6040516020018083838082843780830192505050925050506040516020818303038152906040526040518082805190602001908083835b602083106108f857805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016108bb565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610955573d6000803e3d6000fd5b5050506040513d602081101561096a57600080fd5b5051600261097b896040818d6116fe565b60405160009060200180848480828437919091019283525050604080518083038152602092830191829052805190945090925082918401908083835b602083106109f457805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016109b7565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610a51573d6000803e3d6000fd5b5050506040513d6020811015610a6657600080fd5b5051604080516020818101949094528082019290925280518083038201815260609092019081905281519192909182918401908083835b60208310610ada57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610a9d565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610b37573d6000803e3d6000fd5b5050506040513d6020811015610b4c57600080fd5b50516040805160208101858152929350600092600292839287928f928f92018383808284378083019250505093505050506040516020818303038152906040526040518082805190602001908083835b60208310610bd957805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610b9c565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610c36573d6000803e3d6000fd5b5050506040513d6020811015610c4b57600080fd5b50516040518651600291889160009188916020918201918291908601908083835b60208310610ca957805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610c6c565b6001836020036101000a0380198251168184511680821785525050505050509050018367ffffffffffffffff191667ffffffffffffffff1916815260180182815260200193505050506040516020818303038152906040526040518082805190602001908083835b60208310610d4e57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610d11565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610dab573d6000803e3d6000fd5b5050506040513d6020811015610dc057600080fd5b5051604080516020818101949094528082019290925280518083038201815260609092019081905281519192909182918401908083835b60208310610e3457805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610df7565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015610e91573d6000803e3d6000fd5b5050506040513d6020811015610ea657600080fd5b50519050858114610f02576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260548152602001806117486054913960600191505060405180910390fd5b60205463ffffffff11610f60576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260218152602001806117276021913960400191505060405180910390fd5b602080546001019081905560005b60208110156110a9578160011660011415610fa0578260008260208110610f9157fe5b0155506110ac95505050505050565b600260008260208110610faf57fe5b01548460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b6020831061102557805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101610fe8565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa158015611082573d6000803e3d6000fd5b5050506040513d602081101561109757600080fd5b50519250600282049150600101610f6e565b50fe5b50505050505050565b60606110c26020546114ba565b905090565b6020546000908190815b60208110156112f05781600116600114156111e6576002600082602081106110f557fe5b01548460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b6020831061116b57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0909201916020918201910161112e565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa1580156111c8573d6000803e3d6000fd5b5050506040513d60208110156111dd57600080fd5b505192506112e2565b600283602183602081106111f657fe5b015460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b6020831061126b57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0909201916020918201910161122e565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa1580156112c8573d6000803e3d6000fd5b5050506040513d60208110156112dd57600080fd5b505192505b6002820491506001016110d1565b506002826112ff6020546114ba565b600060401b6040516020018084815260200183805190602001908083835b6020831061135a57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0909201916020918201910161131d565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790527fffffffffffffffffffffffffffffffffffffffffffffffff000000000000000095909516920191825250604080518083037ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8018152601890920190819052815191955093508392850191508083835b6020831061143f57805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09092019160209182019101611402565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01801990921691161790526040519190930194509192505080830381855afa15801561149c573d6000803e3d6000fd5b5050506040513d60208110156114b157600080fd5b50519250505090565b60408051600880825281830190925260609160208201818036833701905050905060c082901b8060071a60f81b826000815181106114f457fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060061a60f81b8260018151811061153757fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060051a60f81b8260028151811061157a57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060041a60f81b826003815181106115bd57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060031a60f81b8260048151811061160057fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060021a60f81b8260058151811061164357fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060011a60f81b8260068151811061168657fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060001a60f81b826007815181106116c957fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535050919050565b6000808585111561170d578182fd5b83861115611719578182fd5b505082019391909203915056fe4465706f736974436f6e74726163743a206d65726b6c6520747265652066756c6c4465706f736974436f6e74726163743a207265636f6e7374727563746564204465706f7369744461746120646f6573206e6f74206d6174636820737570706c696564206465706f7369745f646174615f726f6f744465706f736974436f6e74726163743a20696e76616c6964207769746864726177616c5f63726564656e7469616c73206c656e6774684465706f736974436f6e74726163743a206465706f7369742076616c7565206e6f74206d756c7469706c65206f6620677765694465706f736974436f6e74726163743a20696e76616c6964207075626b6579206c656e6774684465706f736974436f6e74726163743a206465706f7369742076616c756520746f6f20686967684465706f736974436f6e74726163743a206465706f7369742076616c756520746f6f206c6f774465706f736974436f6e74726163743a20696e76616c6964207369676e6174757265206c656e677468a264697066735822122048c9c1aefe892e05fe034c24a651f00a2a8c0eb7e7c569d35ac1920c1a6894bc64736f6c63430006080033"
	runCfgAnly("DepositContract", s)
}

func absIntTestDepositContract2() {
	const s = "60806040526004361061003f5760003560e01c806301ffc9a71461004457806322895118146100b4578063621fd130146101e1578063c5f2892f14610271575b600080fd5b34801561005057600080fd5b5061009c6004803603602081101561006757600080fd5b8101908080357bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916906020019092919050505061029c565b60405180821515815260200191505060405180910390f35b6101df600480360360808110156100ca57600080fd5b81019080803590602001906401000000008111156100e757600080fd5b8201836020820111156100f957600080fd5b8035906020019184600183028401116401000000008311171561011b57600080fd5b90919293919293908035906020019064010000000081111561013c57600080fd5b82018360208201111561014e57600080fd5b8035906020019184600183028401116401000000008311171561017057600080fd5b90919293919293908035906020019064010000000081111561019157600080fd5b8201836020820111156101a357600080fd5b803590602001918460018302840111640100000000831117156101c557600080fd5b90919293919293908035906020019092919050505061036e565b005b3480156101ed57600080fd5b506101f6610fad565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561023657808201518184015260208101905061021b565b50505050905090810190601f1680156102635780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561027d57600080fd5b50610286610fbf565b6040518082815260200191505060405180910390f35b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061036757507f85640907000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b9050919050565b603087879050146103ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001806116bb6026913960400191505060405180910390fd5b60208585905014610426576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260368152602001806116526036913960400191505060405180910390fd5b60608383905014610482576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602981526020018061172e6029913960400191505060405180910390fd5b670de0b6b3a76400003410156104e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001806117086026913960400191505060405180910390fd5b6000633b9aca0034816104f257fe5b0614610549576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260338152602001806116886033913960400191505060405180910390fd5b6000633b9aca00348161055857fe5b04905067ffffffffffffffff80168111156105be576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001806116e16027913960400191505060405180910390fd5b60606105c9826112e3565b90507f649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c589898989858a8a6105fe6020546112e3565b60405180806020018060200180602001806020018060200186810386528e8e82818152602001925080828437600081840152601f19601f82011690508083019250505086810385528c8c82818152602001925080828437600081840152601f19601f82011690508083019250505086810384528a818151815260200191508051906020019080838360005b838110156106a4578082015181840152602081019050610689565b50505050905090810190601f1680156106d15780820380516001836020036101000a031916815260200191505b508681038352898982818152602001925080828437600081840152601f19601f820116905080830192505050868103825287818151815260200191508051906020019080838360005b8381101561073557808201518184015260208101905061071a565b50505050905090810190601f1680156107625780820380516001836020036101000a031916815260200191505b509d505050505050505050505050505060405180910390a1600060028a8a600060801b6040516020018084848082843780830192505050826fffffffffffffffffffffffffffffffff1916815260100193505050506040516020818303038152906040526040518082805190602001908083835b602083106107f957805182526020820191506020810190506020830392506107d6565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa15801561083b573d6000803e3d6000fd5b5050506040513d602081101561085057600080fd5b810190808051906020019092919050505090506000600280888860009060409261087c939291906115a9565b6040516020018083838082843780830192505050925050506040516020818303038152906040526040518082805190602001908083835b602083106108d657805182526020820191506020810190506020830392506108b3565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610918573d6000803e3d6000fd5b5050506040513d602081101561092d57600080fd5b8101908080519060200190929190505050600289896040908092610953939291906115a9565b6000801b604051602001808484808284378083019250505082815260200193505050506040516020818303038152906040526040518082805190602001908083835b602083106109b85780518252602082019150602081019050602083039250610995565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa1580156109fa573d6000803e3d6000fd5b5050506040513d6020811015610a0f57600080fd5b810190808051906020019092919050505060405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b60208310610a795780518252602082019150602081019050602083039250610a56565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610abb573d6000803e3d6000fd5b5050506040513d6020811015610ad057600080fd5b810190808051906020019092919050505090506000600280848c8c604051602001808481526020018383808284378083019250505093505050506040516020818303038152906040526040518082805190602001908083835b60208310610b4c5780518252602082019150602081019050602083039250610b29565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610b8e573d6000803e3d6000fd5b5050506040513d6020811015610ba357600080fd5b8101908080519060200190929190505050600286600060401b866040516020018084805190602001908083835b60208310610bf35780518252602082019150602081019050602083039250610bd0565b6001836020036101000a0380198251168184511680821785525050505050509050018367ffffffffffffffff1916815260180182815260200193505050506040516020818303038152906040526040518082805190602001908083835b60208310610c735780518252602082019150602081019050602083039250610c50565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610cb5573d6000803e3d6000fd5b5050506040513d6020811015610cca57600080fd5b810190808051906020019092919050505060405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b60208310610d345780518252602082019150602081019050602083039250610d11565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610d76573d6000803e3d6000fd5b5050506040513d6020811015610d8b57600080fd5b81019080805190602001909291905050509050858114610df6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260548152602001806115fe6054913960600191505060405180910390fd5b6001602060020a0360205410610e57576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260218152602001806115dd6021913960400191505060405180910390fd5b60016020600082825401925050819055506000602054905060005b6020811015610f945760018083161415610ea5578260008260208110610e9457fe5b018190555050505050505050610fa4565b600260008260208110610eb457fe5b01548460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b60208310610f105780518252602082019150602081019050602083039250610eed565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015610f52573d6000803e3d6000fd5b5050506040513d6020811015610f6757600080fd5b8101908080519060200190929190505050925060028281610f8457fe5b0491508080600101915050610e72565b506000610f9d57fe5b5050505050505b50505050505050565b6060610fba6020546112e3565b905090565b6000806000602054905060005b60208110156111aa57600180831614156110ba57600260008260208110610fef57fe5b01548460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b6020831061104b5780518252602082019150602081019050602083039250611028565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa15801561108d573d6000803e3d6000fd5b5050506040513d60208110156110a257600080fd5b81019080805190602001909291905050509250611190565b600283602183602081106110ca57fe5b015460405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083106111255780518252602082019150602081019050602083039250611102565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa158015611167573d6000803e3d6000fd5b5050506040513d602081101561117c57600080fd5b810190808051906020019092919050505092505b6002828161119a57fe5b0491508080600101915050610fcc565b506002826111b96020546112e3565b600060401b6040516020018084815260200183805190602001908083835b602083106111fa57805182526020820191506020810190506020830392506111d7565b6001836020036101000a0380198251168184511680821785525050505050509050018267ffffffffffffffff1916815260180193505050506040516020818303038152906040526040518082805190602001908083835b602083106112745780518252602082019150602081019050602083039250611251565b6001836020036101000a038019825116818451168082178552505050505050905001915050602060405180830381855afa1580156112b6573d6000803e3d6000fd5b5050506040513d60208110156112cb57600080fd5b81019080805190602001909291905050509250505090565b6060600867ffffffffffffffff811180156112fd57600080fd5b506040519080825280601f01601f1916602001820160405280156113305781602001600182028036833780820191505090505b50905060008260c01b90508060076008811061134857fe5b1a60f81b8260008151811061135957fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060066008811061139557fe5b1a60f81b826001815181106113a657fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350806005600881106113e257fe5b1a60f81b826002815181106113f357fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060046008811061142f57fe5b1a60f81b8260038151811061144057fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060036008811061147c57fe5b1a60f81b8260048151811061148d57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350806002600881106114c957fe5b1a60f81b826005815181106114da57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060016008811061151657fe5b1a60f81b8260068151811061152757fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508060006008811061156357fe5b1a60f81b8260078151811061157457fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535050919050565b600080858511156115b957600080fd5b838611156115c657600080fd5b600185028301915084860390509450949250505056fe4465706f736974436f6e74726163743a206d65726b6c6520747265652066756c6c4465706f736974436f6e74726163743a207265636f6e7374727563746564204465706f7369744461746120646f6573206e6f74206d6174636820737570706c696564206465706f7369745f646174615f726f6f744465706f736974436f6e74726163743a20696e76616c6964207769746864726177616c5f63726564656e7469616c73206c656e6774684465706f736974436f6e74726163743a206465706f7369742076616c7565206e6f74206d756c7469706c65206f6620677765694465706f736974436f6e74726163743a20696e76616c6964207075626b6579206c656e6774684465706f736974436f6e74726163743a206465706f7369742076616c756520746f6f20686967684465706f736974436f6e74726163743a206465706f7369742076616c756520746f6f206c6f774465706f736974436f6e74726163743a20696e76616c6964207369676e6174757265206c656e677468a2646970667358221220b39206b87c12c587ed6a334a474cfb65ef67786d902932a49fe272b4b933d5a764736f6c634300060c0033"
	runCfgAnly("DepositContract2", s)
}

/////////////////////////////////////////////////////

type dummyAccount struct{}

func (dummyAccount) SubBalance(amount *big.Int)                          {}
func (dummyAccount) AddBalance(amount *big.Int)                          {}
func (dummyAccount) SetAddress(common.Address)                           {}
func (dummyAccount) Value() *big.Int                                     { return nil }
func (dummyAccount) SetBalance(*big.Int)                                 {}
func (dummyAccount) SetNonce(uint64)                                     {}
func (dummyAccount) Balance() *big.Int                                   { return nil }
func (dummyAccount) Address() common.Address                             { return common.Address{} }
func (dummyAccount) ReturnGas(*big.Int)                                  {}
func (dummyAccount) SetCode(common.Hash, []byte)                         {}
func (dummyAccount) ForEachStorage(cb func(key, value common.Hash) bool) {}

/*
func testGenCfg() error {
	env := vm.NewEVM(vm.Context{BlockNumber: big.NewInt(1)}, &dummyStatedb{}, params.TestChainConfig,
		vm.Config{
			EVMInterpreter: "SaInterpreter",
		}, nil)

	contract := vm.NewContract(dummyAccount{}, dummyAccount{}, uint256.NewInt(), 10000, vm.NewDestsCache(50000))
	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x1, 0x0}
	//contract.Code = []byte{byte(vm.ADD), 0x1, 0x1, 0x0}

	jt := newIstanbulInstructionSet()
	vm.ToCfg0(contract)
	//_, err := env.Interpreter().Run(contract, []byte{}, false)
	if err != nil {
		return err
	}

	print("Done")
	return nil
}*/

type CfgEval struct {
	numProgramsPassed    int
	numPanic             int
	numAnlyCounterLimit  int
	numShortStack        int
	numStackLimitReached int
	numProgramsAnalyzed  int
	numUnresolved        int
	numLowCoverage       int
	numImprecision       int
	numInvalidOpcode     int
	numInvalidJumpDest   int
	numPrograms          int
	numAddressesPassed   int
	numAddressesAnalyzed int
	numTimeouts          int
	numOOM               int
	numCheckerFailed     int
	maxProofSizeBytes    int
	numStaticStateAccess int
}

func (eval *CfgEval) printStats() {
	fmt.Printf("ProgramsPass=%v ProgramsAnalyzed=%v Programs=%v ProgramsPassRate=%v Timeouts=%v Panic=%v CounterLimit=%v ShortStack=%v StackCountLimit=%v Unresolved=%v Imprecision=%v InvalidOp=%v InvalidJumpDest=%v DeadCode=%v OOM=%v CheckerFailed=%v MaxProofSize=%v SSA=%v PercentSSA=%v\n",
		eval.numProgramsPassed,
		eval.numProgramsAnalyzed,
		eval.numPrograms,
		percent(eval.numProgramsPassed, eval.numProgramsAnalyzed),
		eval.numTimeouts,
		eval.numPanic,
		eval.numAnlyCounterLimit,
		eval.numShortStack,
		eval.numStackLimitReached,
		eval.numUnresolved,
		eval.numImprecision,
		eval.numInvalidOpcode,
		eval.numInvalidJumpDest,
		eval.numLowCoverage,
		eval.numOOM,
		eval.numCheckerFailed,
		eval.maxProofSizeBytes,
		eval.numStaticStateAccess,
		percent(eval.numStaticStateAccess, eval.numProgramsAnalyzed),
	)
}

func (eval *CfgEval) update(result *cfgJobResult, count int) {
	eval.numProgramsAnalyzed++
	eval.numAddressesAnalyzed += count
	if result.metrics.Timeout {
		eval.numTimeouts++
		return
	}

	if result.metrics.OOM {
		eval.numOOM++
		return
	}

	metrics := result.metrics

	if metrics.Valid {
		eval.numProgramsPassed++
		eval.numAddressesPassed += count
	}
	if metrics.Panic {
		eval.numPanic++
	}
	if metrics.AnlyCounterLimit {
		eval.numAnlyCounterLimit++
	}
	if metrics.ShortStack {
		eval.numShortStack++
	}
	if metrics.StackCountLimitReached {
		eval.numStackLimitReached++
	}
	if metrics.Unresolved {
		eval.numUnresolved++
	}
	if metrics.LowCoverage {
		eval.numLowCoverage++
	}
	if metrics.BadJumpImprecision {
		eval.numImprecision++
	}
	if metrics.BadJumpInvalidOp {
		eval.numInvalidOpcode++
	}
	if metrics.BadJumpInvalidJumpDest {
		eval.numInvalidJumpDest++
	}
	if metrics.CheckerFailed {
		eval.numCheckerFailed++
	}
	if metrics.IsStaticStateAccess {
		eval.numStaticStateAccess++
	}
	if eval.maxProofSizeBytes < metrics.ProofSizeBytes {
		eval.maxProofSizeBytes = metrics.ProofSizeBytes
	}
}

type cfgJob struct {
	txcnt int
	code  []byte
}

type cfgJobResult struct {
	job     *cfgJob
	metrics *vm.CfgMetrics
}

func sb(b bool) string {
	return fmt.Sprintf("%v", b)
}

func si(i int) string {
	return fmt.Sprintf("%v", i)
}

func percent(n int, d int) string {
	return fmt.Sprintf("%v%v", n*1000/d/10, "%")
}
